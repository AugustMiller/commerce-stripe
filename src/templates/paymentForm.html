{% import "_includes/forms" as forms %}

{% set currentYear = date()|date_modify("+1 year").format('Y') %}

<div id="gateway-{{ gateway.id }}-form" class="stripe-form gateway-form {% if order and order.gatewayId != gateway.id %}hidden{% endif %}" xmlns="http://www.w3.org/1999/html" data-publishablekey="{{ gateway.publishableKey ?? '' }}">

    <form method="POST">
        <input type="hidden" name="action" value="commerce/payments/pay"/>
        {% if order %}
            {{ redirectInput(order.cpEditUrl) }}
            <input type="hidden" name="cancelUrl" value="{{ order.cpEditUrl }}"/>
            <input type="hidden" name="orderNumber" value="{{ order.number }}"/>
        {% endif %}
        <input type="hidden" name="gatewayId" value="{{ gateway.id }}"/>

        {{ csrfInput() }}

        {% include 'commerce/_components/gateways/common/_creditCardFields' %}

        <div class="card-errors" role="alert"></div>

        <div class="footer">
            <div class="buttons right">
                <input type="submit" class="btn submit" value="Pay {{ order.totalPrice|commerceCurrency(order.currency,convert=true) }} Now">
            </div>
        </div>

    </form>
</div>